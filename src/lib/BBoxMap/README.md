# BBox Map

This SvelteKit component generates an interactive world map with a search field that allows users to easily search for geographic bounding boxes (BBoxes) for various regions, including continents, countries, and cities. The selected bounding box can also be manipulated by dragging the edges.

## Improving Bounding Boxes

Bounding boxes for different regions (continents, countries, cities, etc.) are stored in the `bboxes.json` file. This file is generated by the helper script `helpers/merge_bboxes.ts`, which processes the `*.jsonl` files in the `data` directory.

### Editing Bounding Boxes

To edit or add new bounding boxes:

1. **Modify or Add a JSONL File**: Edit existing JSONL files in the `data` directory or create new ones with the required bounding box data.
2. **Run the `merge_bboxes.ts` Script**: After making changes, run the `merge_bboxes.ts` script to update the `bboxes.json` file.

### Helper Script: `merge_bboxes.ts`

This script consolidates bounding box data from multiple JSONL files in the `data` directory, checks for duplicate labels, and outputs a single, sorted JSON file (`bboxes.json`). The bounding box coordinates are also rounded to an appropriate precision based on their size.

#### Usage

Simply run the script:

```bash
./helpers/merge_bboxes.ts
```

#### Output

The script writes the processed data to `bboxes.json` in the parent directory. The entries in this file are sorted by population and formatted as:

```json
["Label", lngMin, latMin, lngWidth, latHeight]
```

### Helper Script: `geojson2bboxes.ts`

This script processes GeoJSON or GeoJSONL files to extract bounding boxes for each geographic feature, generate labels, and either extract or estimate the population for each feature. The results are saved in JSONL format, which can be used by the `merge_bboxes.ts` script.

#### Usage

```bash
./helpers/geojson2bboxes.ts <FILENAME> <LABEL_TEMPLATE> [POPULATION_KEY]
```

- `<FILENAME>`: The name of the input GeoJSON or GeoJSONL file. The file can be optionally compressed with `.br` (Brotli) or `.gz` (Gzip).
- `<LABEL_TEMPLATE>`: A template string used to generate labels for each feature. Placeholders in the form `{propertyName}` will be replaced by the corresponding property value from each feature.
- `[POPULATION_KEY]`: (Optional) The key in the feature's properties that contains the population value. If not provided, the script will estimate the population.

#### Example

```bash
./helpers/geojson2bboxes.ts africa.geojson "{country}, {city}"
```

This command processes the `africa.geojson` file, generating labels in the format `"country, city"` and estimating the population for each region.

#### Output

The script outputs a `.jsonl` file with entries formatted as follows:

```json
{
  "label": "Country - City",
  "population": 123456,
  "bbox": [minLng, minLat, maxLng, maxLat]
}
```

Place this `.jsonl` file in the `data` directory to include it in the `bboxes.json` file when running `merge_bboxes.ts`.
